%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '16px', 'fontFamily': 'arial' }}}%%
flowchart TD
    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px
    classDef success fill:#d4edda,stroke:#28a745,stroke-width:2px
    classDef warning fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    classDef error fill:#f8d7da,stroke:#dc3545,stroke-width:2px
    classDef primary fill:#cce5ff,stroke:#0d6efd,stroke-width:2px

    Start[/"ğŸš€ Start Backup"/] --> EnvCheck{{"ğŸ” Environment<br/>Check"}}
    
    EnvCheck -->|Failed| InstallReq["ğŸ“¦ Install<br/>Requirements"]
    InstallReq --> EnvCheck
    
    EnvCheck -->|Success| LoadConfig["âš™ï¸ Load<br/>Configuration"]
    
    LoadConfig --> ApiCheck{{"ğŸ”‘ Check<br/>API Key"}}
    ApiCheck -->|Invalid| SetKey["ğŸ” Set API Key"]
    SetKey --> ApiCheck
    
    ApiCheck -->|Valid| GetTables["ğŸ“‹ Get Tables<br/>List"]
    GetTables --> TableLoop["ğŸ“Š Process<br/>Tables"]
    TableLoop --> Download["â¬‡ï¸ Download<br/>Data"]
    Download --> SaveCSV["ğŸ’¾ Save to<br/>CSV"]
    SaveCSV --> MoreTables{"More<br/>Tables?"}
    
    MoreTables -->|Yes| TableLoop
    MoreTables -->|No| Cleanup["ğŸ§¹ Cleanup Old<br/>Backups"]
    
    Cleanup --> Log["ğŸ“ Log<br/>Results"]
    Log --> End[/"âœ… Backup<br/>Complete"/]
    
    subgraph Schedule ["â° Scheduling"]
        Timer["â±ï¸ Timer"] -->|Daily/Weekly| Start
    end

    class Start,End primary
    class EnvCheck,ApiCheck,MoreTables warning
    class InstallReq,SetKey error
    class LoadConfig,GetTables,TableLoop,Download,SaveCSV,Cleanup,Log default
    class Timer,Schedule success